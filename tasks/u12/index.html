<h2>Aufgabe 12.1. Sicherer ArrayWrapper</h2>

<tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Exploit Array Wrapper</h3>
        <p>
            In der Vorlesung wurde ein ArrayWrapper Exploit gezeigt. Analysieren Sie die Ursache dieses Exploits. Entwickeln Sie ein Sicherheitskonzept und eine ArrayWrapper-Lösung, die gegen diesen Exploit gewappnet ist.
        </p>
    </tab-element>

    <tab-element tab-title="Ursachenanalyse">
        <p>
            Das Lücke resultiert aus der Tatsache, dass keine Typenüberprüfung von JS automatisiert vorgenommen wird. Da also nicht gechekt wird, ob es sich in der set-Methode bei dem ersten Parameter um eine Nummer handelt, können auch Key's für das interne JS-Objekt adresseirt und entsprechend geändert werden. Der Exploit nutzt genau dies aus und überschreibt die Prototypenfunktion "push" von Arrays. Ein Aufruf der append Methode, sorgt schließlich dafür, dass die überschriebene Methode auch gecalled wird. Der Exploid speichert sich schließlich den Zustand des internen Array's.
        </p>
    </tab-element>

    <tab-element tab-title="Sicherheitskonzept">
        <p>
            Prinzipiell sollte man keinem User trauen und die Eingaben sorgfältig prüfen. Anstatt alles zu verbieten, was irgendwie zu Problemen führen könnte (Blacklisting), sollten nur die Eingaben möglich sein, die auch erlaubt sind (Whitelisting). Mit einem einfachen regulären Ausdruck kann sicher gestellt werden, dass nur Nummern als Positionsparameter erlaubt werden. Alternativ oder zusätzlich könnte durch entsprechende Typumwandlung ein ähnliches Verhalten erreicht werden.     
        </p>
    </tab-element>

    <tab-element tab-title="Vorschau">
        <js-console src="tasks/u12/a1.js"></js-console>
    </tab-element>
  </tab-view>

  <h2>Aufgabe 12.2 WebGoat Injection</h2>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.2</h3>
        <p>
            In der ersten Aufgabe sollte als eine kleine Übung eine einfache Abfrage mit SQL abgesetzt werden. 
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a2.png" alt="a2.png">
            <figcaption>Abbildung 12.1: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.3</h3>
        <p>
            Zur weiteren Übung sollte anschließend ein Wert in der Tabelle <dfn>employee</dfn> geändert werden.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a3.png" alt="a3.png">
            <figcaption>Abbildung 12.2: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.4</h3>
        <p>
            Danach sollte die Tabelle um das Datenfeld <dfn>phone</dfn> ergänzt werden.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a4.png" alt="a4.png">
            <figcaption>Abbildung 12.3: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.5</h3>
        <p>
            Anschließend sollten alle Rechte auf die Tabelle grant_rights für den Benutzer <dfn>unauthorized_user</dfn> gewährt werden.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a5.png" alt="a5.png">
            <figcaption>Abbildung 12.5: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.9</h3>
        <p>
            Einfache SQL-Injection die ein logisches oder in das SQL-Statement inkludiert.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a9.png" alt="a9.png">
            <figcaption>Abbildung 12.6: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>


  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.10</h3>
        <p>
            Wie bereits bei Aufgabe 12.2.9 wird hier eine logische Operation in das Statement eingefügt, was den losgisch Ausdruck allgemeingültig macht (Tautologie).
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a10.png" alt="a10.png">
            <figcaption>Abbildung 12.7: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.11</h3>
        <p>
            Auch hier wird wieder ein logischer Ausdruck in das Statement eingeschoben. Im vergleich zu den vorherigen Aufgaben muss hier darauf Acht gegeben werden, dass der Ausdruck mit korrekten Anführungszeichen versehen wird, damit der Ausdruck wie geplant vom SQL Interpreter ausgewertet wird.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a11.png" alt="a11.png">
            <figcaption>Abbildung 12.8: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.12</h3>
        <p>
            In dieser Teil AUfgabe wurde ein zusätzliches SQL Statement an das bestehende angehangen. Dieses Statement hat dafür gesorgt, dass das Feld <dfn>salary</dfn> in der Tabelle <dfn>employee</dfn> geupdated wurde.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a12.png" alt="a12.png">
            <figcaption>Abbildung 12.9: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.2.13</h3>
        <p>
            In der letzten Aufgabe im Bereich SQL-Injection war es das Ziel, die Tabelle <dfn>access_log</dfn> zu löschen. Dazu wurde ein drop tabel Statement eingebaut.  
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/sql_injection/a13.png" alt="a13.png">
            <figcaption>Abbildung 12.10: TODO</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  

  <h2>Aufgabe 12.3. WebGoat XSS</h2>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.3.2</h3>
        <p>
            Da man durch <dfn>Cross-Site Scripting (XSS)</dfn> häufig Sitzung stielt, da Cookies im Browser abliegen, sollte man in der ersten Aufgabe einfach mal vergleichen, ob die Cookies in verschiedenen Tabs identisch sind. Dies war der Fall.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xss/2.png" alt="a2.png">
            <figcaption>Abbildung 12.11:</figcaption>
        </figure>
    </tab-element>
  </tab-view>


  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.3.7</h3>
        <p>
            In der zweiten Aufgabe sollte ein Formular daraufhin überprüft werden, ob es möglich ist, ein Script Tag einzuschleusen. Dies war in den oberen Feldern nicht ohne Weiteres möglich, da diese die Eingabe auf einen zulässigen Wert beschränken (Whitelisting). Im ersten Texteingabefeld war dies jedoch ohne Probleme möglich, da der Inhalt des Feldes in die Webseite aufgenommen wurde. Dadurch konnte ein eigenes Script ausgeführt werden.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xss/7.png" alt="a7.png">
            <figcaption>Abbildung 12.12:</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.3.10</h3>
        <p>
            In dieser Aufgabe sollte eine Schwachstelle in der Seite gefunden werden. Es war bekannt, dass eine Testroute noch in der Webseite vorhanden sein musste. In der Datei <dfn>GoatRouter.js</dfn> konnte die entsprechende Route ausfindig gemacht werden (Siehe Abb. 12.13 Zeile 52). 
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xss/10.png" alt="a10.png">
            <figcaption>Abbildung 12.13:</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.3.11</h3>
        <p>
            In dieser Aufgabe sollte die Testroute aus der vorherigen Aufgabe genutzt werden, um eine interne Funktion aufzurufen, welche eine Nummer auf der Console ausgibt.
        </p>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xss/11.png" alt="a11.png">
            <figcaption>Abbildung 12.14:</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="Solution">
        <h3>Aufgabe 12.3.12</h3>

        <figure>
            <img src="tasks/u12/xss/12.png" alt="a12.png">
            <figcaption>Abbildung 12.15:</figcaption>
        </figure>
    </tab-element>
  </tab-view>


  <h2>Aufgabe 12.4. WebGoat Cross-Site Request Forgeries</h2>
  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.4.3</h3>
        <p>
            In der ersten Aufgabe zum Themenbereich <dfn>Cross-Site Reques Forgeries</dfn> sollte eine Post-Anfrage an einen Endpoint abgesetzt werden. Dan HTML/JS Code dazu können Sie dem Tab Code entnehmen.
        </p>
    </tab-element>

    <tab-element tab-title="Code">
        <file-viewer src="tasks/u12/xsrf/a3.html"></file-viewer>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xsrf/3.png" alt="a3.png">
            <figcaption>Abbildung 12.16:</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.4.4</h3>
        <p>
            In dieser Aufgabe sollte eine Bewertung für ein Bild unter einem anderen Namen abgegeben werden. Dazu musste zuerst das Formular auf der eigentlichen Webseite analysiert werden, damit die entsprechenden Felder gesetzt werden konnten. Der Code aus dem Tab "Code" konnte dann eingesetzt werden, um eine Bewertung abzugeben.
        </p>
    </tab-element>

    <tab-element tab-title="Code">
        <file-viewer src="tasks/u12/xsrf/a4.html"></file-viewer>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xsrf/4.png" alt="a4.png">
            <figcaption>Abbildung 12.17:</figcaption>
        </figure>
    </tab-element>
  </tab-view>

  <tab-view>
    <tab-element tab-title="&#9432;">
        <h3>Aufgabe 12.4.7</h3>
        <p>
            Danach sollte wieder eine Manipulation auf einen Endpoint vorgenommen werden. Da der Content-Type nicht serverseitig überprüft, wurde konnte das JSON an den Endpoint übertragen werden. 
        </p>
    </tab-element>

    <tab-element tab-title="Code">
        <file-viewer src="tasks/u12/xsrf/a7.html"></file-viewer>
    </tab-element>

    <tab-element tab-title="Solution">
        <figure>
            <img src="tasks/u12/xsrf/7.png" alt="a7.png">
            <figcaption>Abbildung 12.16:</figcaption>
        </figure>
    </tab-element>
  </tab-view>