<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

</head>
<body>
    <h1>Security</h1>
    <script>
        //Array Wrapper
        function arrayWrapper(){
            let array = [...arguments];
            return{
                get: pos=>{return array[pos]},
                set: (pos, val)=>{array[pos] = val},
                append: val => {array.push(val)}
            }
        }

        //Array Wrapper
        function arrayWrapper2(){
            let array = [...arguments];
            return{
                get: pos=>{return array[pos]},
                set: (pos, val)=>{
                    regex = /^[0-9]+/;
                    if(regex.test(pos)){
                        pos = parseInt(pos);
                        array[pos] = val
                    }else{
                        throw new Error("Invalid input for Parameter 'pos'");
                    }
                   
                },
                append: val => {array.push(val)}
            }
        }

        //Array Exploit
        function exploit(vector){
            let data;
            vector.set('push', function(){data = this});
            vector.append();
            return data;
        }


       /*
       Das Lücke resultiert aus der Tatsache, dass keine Typenüberprüfung von JS automatisiert vorgenommen wird. Da also nicht gechekt wird, ob es sich in der set-Methode bei dem ersten Parameter um eine Nummer handelt, können auch Key's für das interne JS-Objekt adresseirt und entsprechend geändert werden. Der Exploit nutzt genau dies aus und überschreibt die Prototypenfunktion "push" von Arrays. Ein Aufruf der append Methode, sorgt schließlich dafür, dass die überschriebene Methode auch gecalled wird. Der Exploid speichert sich schließlich den Zustand des internen Array's.


       Prinzipiell sollte man keinem User trauen und die Eingaben sorgfältig prüfen. Anstatt alles zu verbieten, was irgendwie zu Problemen führen könnte (Blacklisting), sollten nur die Eingaben möglich sein, die auch erlaubt sind (Whitelisting). Mit einem einfachen regulären Ausdruck kann sicher gestellt werden, dass nur Nummern als Positionsparameter erlaubt werden. Alternativ oder zusätzlich könnte durch entsprechende Typumwandlung ein ähnliches Verhalten erreicht werden.     
       
       */ 

    </script>
    
</body>
</html>